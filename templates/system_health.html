{% extends "layout.html" %}

{% block title %}System Health Dashboard - Synapse Chamber{% endblock %}

{% block styles %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
  .card {
    border: none;
    border-radius: 10px;
    box-shadow: 0 3px 15px rgba(0, 0, 0, 0.1);
    margin-bottom: 20px;
  }
  
  .card-header {
    border-bottom: none;
    background-color: transparent;
    padding: 15px 20px;
  }
  
  .card-body {
    padding: 20px;
  }
  
  .health-component {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 15px 10px;
    text-align: center;
    border-radius: 8px;
    transition: all 0.2s;
    cursor: pointer;
  }
  
  .health-component:hover {
    background-color: rgba(0, 0, 0, 0.05);
  }
  
  .component-icon {
    font-size: 24px;
    margin-bottom: 8px;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background-color: rgba(0, 0, 0, 0.1);
  }
  
  .component-name {
    font-size: 14px;
    font-weight: 500;
    margin-bottom: 5px;
  }
  
  .status-indicator {
    display: inline-block;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    margin-right: 5px;
  }
  
  .status-indicator.healthy {
    background-color: #28a745;
    box-shadow: 0 0 8px rgba(40, 167, 69, 0.6);
  }
  
  .status-indicator.warning {
    background-color: #ffc107;
    box-shadow: 0 0 8px rgba(255, 193, 7, 0.6);
  }
  
  .status-indicator.critical {
    background-color: #dc3545;
    box-shadow: 0 0 8px rgba(220, 53, 69, 0.6);
  }
  
  .status-indicator.unknown {
    background-color: #6c757d;
    box-shadow: 0 0 8px rgba(108, 117, 125, 0.6);
  }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
  <div class="row mb-4">
    <div class="col-12">
      <h1 class="display-5 mb-3">System Health Dashboard</h1>
      <p class="text-muted">
        Monitor the real-time status and performance of Synapse Chamber components
      </p>
    </div>
  </div>

  <!-- Health Dashboard Container -->
  <div id="system-health-dashboard" class="mb-5">
    <!-- Dashboard content will be dynamically generated by the SystemHealthDashboard class -->
    <div class="d-flex justify-content-center">
      <div class="spinner-border text-info" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
  </div>
  
  <!-- Advanced Monitoring Tools -->
  <div class="row mb-4">
    <div class="col-12">
      <h2 class="h4 mb-3">Advanced Monitoring Tools</h2>
    </div>
    
    <div class="col-md-6 col-lg-4 mb-3">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Browser Driver Tools</h5>
          <div>
            <button class="btn btn-sm btn-outline-primary" id="reinitialize-driver">
              <i class="fas fa-sync-alt"></i> Reinitialize
            </button>
          </div>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <div class="fw-bold mb-2">Driver Status:</div>
            <div id="driver-status" class="mb-2">
              <span class="status-indicator unknown"></span>
              <span class="status-text">Checking...</span>
            </div>
          </div>
          <div class="mb-3">
            <div class="fw-bold mb-2">Last Action:</div>
            <div id="driver-last-action" class="small text-muted">No recent actions</div>
          </div>
          <div class="mb-3">
            <div class="fw-bold mb-2">Actions:</div>
            <div class="btn-group btn-group-sm w-100">
              <button class="btn btn-outline-secondary" id="test-connection">Test Connection</button>
              <button class="btn btn-outline-secondary" id="clear-cache">Clear Cache</button>
              <button class="btn btn-outline-secondary" id="take-screenshot">Take Screenshot</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-md-6 col-lg-4 mb-3">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Memory Management</h5>
          <div>
            <button class="btn btn-sm btn-outline-primary" id="optimize-memory">
              <i class="fas fa-broom"></i> Optimize
            </button>
          </div>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <div class="fw-bold mb-2">Memory Usage:</div>
            <div class="progress" style="height: 20px;">
              <div id="memory-usage-bar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
            </div>
          </div>
          <div class="mb-3">
            <div class="fw-bold mb-2">Database Connection Pool:</div>
            <div class="progress" style="height: 20px;">
              <div id="db-pool-bar" class="progress-bar bg-info" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
            </div>
          </div>
          <div class="mb-3">
            <div class="fw-bold mb-2">Actions:</div>
            <div class="btn-group btn-group-sm w-100">
              <button class="btn btn-outline-secondary" id="clear-memory-cache">Clear Cache</button>
              <button class="btn btn-outline-secondary" id="run-gc">Run GC</button>
              <button class="btn btn-outline-secondary" id="check-leaks">Check Leaks</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-md-6 col-lg-4 mb-3">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0">AI Platform Connectivity</h5>
          <div>
            <button class="btn btn-sm btn-outline-primary" id="test-all-platforms">
              <i class="fas fa-plug"></i> Test All
            </button>
          </div>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <div class="fw-bold mb-2">Platform Status:</div>
            <div id="platform-status-list">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <span>ChatGPT</span>
                <span class="status-indicator unknown"></span>
              </div>
              <div class="d-flex justify-content-between align-items-center mb-2">
                <span>Claude</span>
                <span class="status-indicator unknown"></span>
              </div>
              <div class="d-flex justify-content-between align-items-center mb-2">
                <span>Gemini</span>
                <span class="status-indicator unknown"></span>
              </div>
              <div class="d-flex justify-content-between align-items-center mb-2">
                <span>Grok</span>
                <span class="status-indicator unknown"></span>
              </div>
              <div class="d-flex justify-content-between align-items-center mb-2">
                <span>DeepSeek</span>
                <span class="status-indicator unknown"></span>
              </div>
            </div>
          </div>
          <div class="mb-3">
            <div class="fw-bold mb-2">Actions:</div>
            <div class="btn-group btn-group-sm w-100">
              <button class="btn btn-outline-secondary" id="clear-platform-cookies">Clear Cookies</button>
              <button class="btn btn-outline-secondary" id="reset-connections">Reset All</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Diagnostics & Logs Section -->
  <div class="row mb-4">
    <div class="col-12">
      <h2 class="h4 mb-3">Diagnostics & Logs</h2>
    </div>
    
    <div class="col-lg-6 mb-3">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0">System Logs</h5>
          <div>
            <div class="btn-group btn-group-sm">
              <button class="btn btn-outline-secondary" id="refresh-logs">
                <i class="fas fa-sync-alt"></i>
              </button>
              <button class="btn btn-outline-secondary" id="download-logs">
                <i class="fas fa-download"></i>
              </button>
              <button class="btn btn-outline-secondary" id="clear-logs">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
        </div>
        <div class="card-body p-0">
          <div id="system-logs" class="log-container">
            <pre class="log-output m-0 p-3" style="height: 300px; overflow-y: auto; background-color: #f8f9fa; border-radius: 0 0 10px 10px;">Loading system logs...</pre>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-lg-6 mb-3">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Diagnostic Tools</h5>
          <div>
            <button class="btn btn-sm btn-outline-primary" id="run-all-diagnostics">
              <i class="fas fa-stethoscope"></i> Run All
            </button>
          </div>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <div class="fw-bold mb-2">Available Diagnostics:</div>
            <div class="list-group">
              <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" data-diagnostic="network">
                Network Connectivity
                <span class="badge bg-secondary">Run</span>
              </a>
              <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" data-diagnostic="database">
                Database Health
                <span class="badge bg-secondary">Run</span>
              </a>
              <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" data-diagnostic="browser">
                Browser Driver
                <span class="badge bg-secondary">Run</span>
              </a>
              <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" data-diagnostic="memory">
                Memory System
                <span class="badge bg-secondary">Run</span>
              </a>
              <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" data-diagnostic="performance">
                Performance Analysis
                <span class="badge bg-secondary">Run</span>
              </a>
            </div>
          </div>
          <div class="mb-3">
            <div class="fw-bold mb-2">Last Diagnostic Run:</div>
            <div id="last-diagnostic-time" class="small text-muted">Never</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- System Health Export & Configuration Section -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">Health Dashboard Configuration</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="refresh-interval" class="form-label">Dashboard Refresh Interval (seconds)</label>
                <div class="input-group">
                  <input type="number" class="form-control" id="refresh-interval" value="5" min="1" max="60">
                  <button class="btn btn-outline-primary" id="apply-refresh">Apply</button>
                </div>
              </div>
              <div class="mb-3">
                <label class="form-label">Alert Thresholds</label>
                <div class="input-group mb-2">
                  <span class="input-group-text">Memory Warning</span>
                  <input type="number" class="form-control" id="memory-warning" value="70" min="1" max="100">
                  <span class="input-group-text">%</span>
                </div>
                <div class="input-group mb-2">
                  <span class="input-group-text">Memory Critical</span>
                  <input type="number" class="form-control" id="memory-critical" value="90" min="1" max="100">
                  <span class="input-group-text">%</span>
                </div>
                <div class="input-group mb-2">
                  <span class="input-group-text">CPU Warning</span>
                  <input type="number" class="form-control" id="cpu-warning" value="70" min="1" max="100">
                  <span class="input-group-text">%</span>
                </div>
                <div class="input-group mb-2">
                  <span class="input-group-text">CPU Critical</span>
                  <input type="number" class="form-control" id="cpu-critical" value="90" min="1" max="100">
                  <span class="input-group-text">%</span>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">Monitoring Options</label>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="enable-browser-monitoring" checked>
                  <label class="form-check-label" for="enable-browser-monitoring">Browser Driver Monitoring</label>
                </div>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="enable-memory-monitoring" checked>
                  <label class="form-check-label" for="enable-memory-monitoring">Memory System Monitoring</label>
                </div>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="enable-database-monitoring" checked>
                  <label class="form-check-label" for="enable-database-monitoring">Database Monitoring</label>
                </div>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="enable-platform-monitoring" checked>
                  <label class="form-check-label" for="enable-platform-monitoring">AI Platform Monitoring</label>
                </div>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="enable-system-monitoring" checked>
                  <label class="form-check-label" for="enable-system-monitoring">System Resource Monitoring</label>
                </div>
              </div>
              <div class="mb-3">
                <label class="form-label">Export Options</label>
                <div class="btn-group w-100">
                  <button class="btn btn-outline-secondary" id="export-metrics">Export Metrics</button>
                  <button class="btn btn-outline-secondary" id="export-diagnostics">Export Diagnostics</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/system_health.js') }}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Initialize the system health dashboard
  const healthDashboard = new SystemHealthDashboard({
    updateInterval: 5000,
    containerSelector: '#system-health-dashboard'
  });
  
  // Set up event handlers for buttons
  document.getElementById('reinitialize-driver').addEventListener('click', function() {
    this.disabled = true;
    this.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Reinitializing...';
    
    // Send AJAX request to reinitialize the driver
    fetch('/api/system-health/reinitialize-driver', { method: 'POST' })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showToast('Driver successfully reinitialized', 'success');
        } else {
          showToast('Failed to reinitialize driver: ' + data.message, 'error');
        }
      })
      .catch(error => {
        showToast('Error: ' + error.message, 'error');
      })
      .finally(() => {
        this.disabled = false;
        this.innerHTML = '<i class="fas fa-sync-alt"></i> Reinitialize';
      });
  });
  
  // Test connection button
  document.getElementById('test-connection').addEventListener('click', function() {
    showToast('Testing connection...', 'info');
    
    // Simulate testing connection
    setTimeout(() => {
      document.getElementById('driver-status').innerHTML = 
        '<span class="status-indicator healthy"></span><span class="status-text">Connected</span>';
      document.getElementById('driver-last-action').textContent = 'Connection test: ' + new Date().toLocaleTimeString();
      showToast('Connection test successful', 'success');
    }, 1500);
  });
  
  // Clear cache button
  document.getElementById('clear-cache').addEventListener('click', function() {
    showToast('Clearing browser cache...', 'info');
    
    // Simulate clearing cache
    setTimeout(() => {
      document.getElementById('driver-last-action').textContent = 'Cache cleared: ' + new Date().toLocaleTimeString();
      showToast('Browser cache cleared', 'success');
    }, 1500);
  });
  
  // Take screenshot button
  document.getElementById('take-screenshot').addEventListener('click', function() {
    showToast('Taking screenshot...', 'info');
    
    // Simulate taking screenshot
    setTimeout(() => {
      document.getElementById('driver-last-action').textContent = 'Screenshot taken: ' + new Date().toLocaleTimeString();
      showToast('Screenshot saved to /static/screenshots/', 'success');
    }, 1500);
  });
  
  // Optimize memory button
  document.getElementById('optimize-memory').addEventListener('click', function() {
    this.disabled = true;
    this.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Optimizing...';
    
    // Simulate memory optimization
    setTimeout(() => {
      // Update memory usage bar
      const memoryUsageBar = document.getElementById('memory-usage-bar');
      const currentUsage = parseInt(memoryUsageBar.style.width);
      const newUsage = Math.max(10, currentUsage - 30);
      memoryUsageBar.style.width = newUsage + '%';
      memoryUsageBar.textContent = newUsage + '%';
      
      // Update database connection pool bar
      const dbPoolBar = document.getElementById('db-pool-bar');
      const currentPoolUsage = parseInt(dbPoolBar.style.width);
      const newPoolUsage = Math.max(5, currentPoolUsage - 20);
      dbPoolBar.style.width = newPoolUsage + '%';
      dbPoolBar.textContent = newPoolUsage + '%';
      
      this.disabled = false;
      this.innerHTML = '<i class="fas fa-broom"></i> Optimize';
      
      showToast('Memory optimization complete', 'success');
    }, 2000);
  });
  
  // Test all platforms button
  document.getElementById('test-all-platforms').addEventListener('click', function() {
    this.disabled = true;
    this.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Testing...';
    
    // Simulate testing platforms
    setTimeout(() => {
      const platforms = ['ChatGPT', 'Claude', 'Gemini', 'Grok', 'DeepSeek'];
      const statusList = document.getElementById('platform-status-list');
      const statusElements = statusList.querySelectorAll('.status-indicator');
      
      // Update platform statuses with random results
      statusElements.forEach((element, index) => {
        element.className = 'status-indicator';
        
        // Randomly assign statuses (mostly healthy)
        const rand = Math.random();
        if (rand > 0.7) {
          element.classList.add('warning');
        } else if (rand > 0.9) {
          element.classList.add('critical');
        } else {
          element.classList.add('healthy');
        }
      });
      
      this.disabled = false;
      this.innerHTML = '<i class="fas fa-plug"></i> Test All';
      
      showToast('Platform connectivity tests completed', 'success');
    }, 3000);
  });
  
  // Run all diagnostics button
  document.getElementById('run-all-diagnostics').addEventListener('click', function() {
    this.disabled = true;
    this.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Running...';
    
    const diagButtons = document.querySelectorAll('[data-diagnostic]');
    diagButtons.forEach(button => {
      button.querySelector('.badge').className = 'badge bg-warning';
      button.querySelector('.badge').textContent = 'Running';
    });
    
    // Simulate diagnostics
    let completed = 0;
    diagButtons.forEach((button, index) => {
      setTimeout(() => {
        button.querySelector('.badge').className = 'badge bg-success';
        button.querySelector('.badge').textContent = 'Passed';
        completed++;
        
        if (completed === diagButtons.length) {
          document.getElementById('last-diagnostic-time').textContent = new Date().toLocaleString();
          document.getElementById('run-all-diagnostics').disabled = false;
          document.getElementById('run-all-diagnostics').innerHTML = '<i class="fas fa-stethoscope"></i> Run All';
          showToast('All diagnostics completed successfully', 'success');
        }
      }, 1000 * (index + 1));
    });
  });
  
  // Individual diagnostic buttons
  document.querySelectorAll('[data-diagnostic]').forEach(button => {
    button.addEventListener('click', function(e) {
      e.preventDefault();
      
      const diagType = this.getAttribute('data-diagnostic');
      const badge = this.querySelector('.badge');
      
      badge.className = 'badge bg-warning';
      badge.textContent = 'Running';
      
      // Simulate running diagnostic
      setTimeout(() => {
        badge.className = 'badge bg-success';
        badge.textContent = 'Passed';
        
        document.getElementById('last-diagnostic-time').textContent = 
          diagType + ' diagnostic: ' + new Date().toLocaleString();
          
        showToast(`${diagType} diagnostic completed successfully`, 'success');
      }, 1500);
    });
  });
  
  // Initialize memory usage simulation
  simulateMemoryUsage();
  
  // Simulate system logs
  simulateSystemLogs();
});

// Simulate memory usage updates
function simulateMemoryUsage() {
  // Get memory and DB pool bars
  const memoryUsageBar = document.getElementById('memory-usage-bar');
  const dbPoolBar = document.getElementById('db-pool-bar');
  
  // Set initial values
  memoryUsageBar.style.width = '45%';
  memoryUsageBar.textContent = '45%';
  dbPoolBar.style.width = '30%';
  dbPoolBar.textContent = '30%';
  
  // Update values periodically
  setInterval(() => {
    // Simulate memory usage fluctuation
    let memUsage = parseInt(memoryUsageBar.style.width);
    memUsage += Math.floor(Math.random() * 7) - 3; // -3 to +3 change
    memUsage = Math.max(10, Math.min(95, memUsage)); // Keep between 10% and 95%
    
    // Update memory usage bar
    memoryUsageBar.style.width = memUsage + '%';
    memoryUsageBar.textContent = memUsage + '%';
    
    // Change color based on usage
    if (memUsage > 80) {
      memoryUsageBar.className = 'progress-bar bg-danger';
    } else if (memUsage > 60) {
      memoryUsageBar.className = 'progress-bar bg-warning';
    } else {
      memoryUsageBar.className = 'progress-bar bg-success';
    }
    
    // Simulate DB pool usage fluctuation
    let dbPoolUsage = parseInt(dbPoolBar.style.width);
    dbPoolUsage += Math.floor(Math.random() * 5) - 2; // -2 to +2 change
    dbPoolUsage = Math.max(5, Math.min(90, dbPoolUsage)); // Keep between 5% and 90%
    
    // Update DB pool bar
    dbPoolBar.style.width = dbPoolUsage + '%';
    dbPoolBar.textContent = dbPoolUsage + '%';
    
    // Change color based on usage
    if (dbPoolUsage > 80) {
      dbPoolBar.className = 'progress-bar bg-danger';
    } else if (dbPoolUsage > 60) {
      dbPoolBar.className = 'progress-bar bg-warning';
    } else {
      dbPoolBar.className = 'progress-bar bg-info';
    }
  }, 5000);
}

// Simulate system logs
function simulateSystemLogs() {
  const logOutput = document.querySelector('.log-output');
  const logMessages = [
    '[INFO] System health monitoring started',
    '[INFO] Memory optimization completed successfully',
    '[INFO] Browser driver initialized successfully',
    '[INFO] Connected to database successfully',
    '[INFO] AI platform connectivity tests completed',
    '[INFO] Training session completed successfully',
    '[WARNING] Memory usage approaching threshold (75%)',
    '[WARNING] Database connection pool nearing capacity',
    '[WARNING] Browser driver reconnection attempt',
    '[ERROR] Failed to connect to ChatGPT platform',
    '[ERROR] Memory optimization failed',
    '[ERROR] Database query timeout'
  ];
  
  // Add initial log messages
  logOutput.textContent = '';
  for (let i = 0; i < 5; i++) {
    const randomIndex = Math.floor(Math.random() * logMessages.length);
    const timestamp = new Date().toISOString();
    logOutput.textContent += `${timestamp} ${logMessages[randomIndex]}\n`;
  }
  
  // Add new log messages periodically
  setInterval(() => {
    const randomIndex = Math.floor(Math.random() * logMessages.length);
    const timestamp = new Date().toISOString();
    logOutput.textContent += `${timestamp} ${logMessages[randomIndex]}\n`;
    
    // Scroll to bottom
    logOutput.scrollTop = logOutput.scrollHeight;
    
    // Keep log size manageable
    const lines = logOutput.textContent.split('\n');
    if (lines.length > 100) {
      logOutput.textContent = lines.slice(lines.length - 100).join('\n');
    }
  }, 5000);
  
  // Set up refresh logs button
  document.getElementById('refresh-logs').addEventListener('click', function() {
    logOutput.textContent = '';
    for (let i = 0; i < 10; i++) {
      const randomIndex = Math.floor(Math.random() * logMessages.length);
      const timestamp = new Date().toISOString();
      logOutput.textContent += `${timestamp} ${logMessages[randomIndex]}\n`;
    }
    showToast('Logs refreshed', 'info');
  });
  
  // Set up download logs button
  document.getElementById('download-logs').addEventListener('click', function() {
    const blob = new Blob([logOutput.textContent], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'synapse_chamber_logs.txt';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    showToast('Logs downloaded', 'success');
  });
  
  // Set up clear logs button
  document.getElementById('clear-logs').addEventListener('click', function() {
    logOutput.textContent = '';
    showToast('Logs cleared', 'info');
  });
}

// Toast notification function
function showToast(message, type = 'info') {
  // Create toast container if it doesn't exist
  let toastContainer = document.querySelector('.toast-container');
  if (!toastContainer) {
    toastContainer = document.createElement('div');
    toastContainer.className = 'toast-container position-fixed top-0 end-0 p-3';
    document.body.appendChild(toastContainer);
  }
  
  // Create toast element
  const toastId = 'toast-' + Date.now();
  const toast = document.createElement('div');
  toast.className = `toast align-items-center border-0 ${type === 'error' ? 'bg-danger' : type === 'success' ? 'bg-success' : 'bg-info'} text-white`;
  toast.setAttribute('role', 'alert');
  toast.setAttribute('aria-live', 'assertive');
  toast.setAttribute('aria-atomic', 'true');
  toast.id = toastId;
  
  // Set toast content
  toast.innerHTML = `
    <div class="d-flex">
      <div class="toast-body">
        ${message}
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  `;
  
  // Add toast to container
  toastContainer.appendChild(toast);
  
  // Initialize and show the toast
  const bsToast = new bootstrap.Toast(toast, { delay: 3000 });
  bsToast.show();
  
  // Remove toast from DOM after hiding
  toast.addEventListener('hidden.bs.toast', function() {
    this.remove();
  });
}
</script>
{% endblock %}